<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Liquid Glass Slides</title>

  <!-- Fonts (optional) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">

  <!-- Export libs -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <style>
    :root{
      --bg0:#070A0F;
      --bg1:#06121A;
      --glass: rgba(255,255,255,.08);
      --glass2: rgba(255,255,255,.12);
      --stroke: rgba(255,255,255,.18);
      --shadow: 0 22px 70px rgba(0,0,0,.55);
      --text:#E9EEF7;
      --muted: rgba(233,238,247,.72);
      --accent:#00BF63;
      --danger:#ff4d4d;
      --radius: 22px;
    }

    *{box-sizing:border-box; letter-spacing: 0 !important;}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Tajawal", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      direction: rtl;
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      font-feature-settings: "liga" 1, "calt" 1;
      background:
        radial-gradient(1200px 800px at 20% 20%, rgba(0,191,99,.18), transparent 60%),
        radial-gradient(900px 700px at 80% 25%, rgba(0,140,255,.12), transparent 60%),
        radial-gradient(800px 700px at 60% 90%, rgba(255,140,0,.08), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow:hidden;
    }

    /* Liquid Glass base */
    .glass{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      border-radius: var(--radius);
    }

    .app{
      height:100%;
      display:grid;
      grid-template-rows: auto 1fr auto;
      gap:14px;
      padding:16px;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:12px 14px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 240px;
    }
    .logoDot{
      width:14px;height:14px;border-radius:999px;
      background: var(--accent);
      box-shadow: 0 0 22px rgba(0,191,99,.55);
    }
    .brand h1{
      font-size:16px;margin:0;font-weight:800;
    }
    .brand small{display:block;color:var(--muted);font-weight:500;margin-top:2px}

    .toolbar{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    button{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.08);
      color:var(--text);
      border-radius: 14px;
      padding:10px 12px;
      font-weight:700;
      cursor:pointer;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    button:hover{background: rgba(255,255,255,.12)}
    button:active{transform: scale(.98)}
    .btnAccent{border-color: rgba(0,191,99,.5)}
    .btnDanger{border-color: rgba(255,77,77,.45)}
    .btnGhost{background: rgba(255,255,255,.04)}

    main{
      display:grid;
      grid-template-columns: 1fr 460px;
      gap:14px;
      min-height:0;
    }

    /* Slide Preview Area */
    .stage{
      position:relative;
      padding:14px;
      min-height:0;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:auto;
    }
    .slideWrap{
      padding:24px;
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    /* PDF Page Background (behind the card) */
    .pdfPageBg{
      position:absolute;
      inset:0;
      border-radius: 16px;
      overflow:hidden;
    }

    /* The "exported" slide content root */
    .slide{
      width: 720px;
      min-height: 400px;
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.20);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: 0 25px 80px rgba(0,0,0,.55);
      padding:42px 50px;
      overflow:hidden;
      position:relative;
    }

    /* Liquid Glass overlay effect */
    .slide::before{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      pointer-events:none;
      border-radius: 22px;
    }

    /* subtle glass highlights */
    .slide::after{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(600px 220px at 30% 0%, rgba(255,255,255,.20), transparent 55%);
      pointer-events:none;
      opacity:.7;
    }

    .slideHeader{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:16px;
      position:relative;
      z-index:1;
    }
    .slideTitle{
      font-size:42px;
      line-height:1.12;
      margin:0;
      font-weight:900;
      letter-spacing: 0;
      word-spacing: normal;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }
    .slideMeta{
      text-align:left;
      color:rgba(233,238,247,.78);
      font-weight:700;
      font-size:14px;
      white-space:nowrap;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      margin-top:10px;
    }
    .chipDot{
      width:8px;height:8px;border-radius:999px;background:var(--accent);
      box-shadow: 0 0 18px rgba(0,191,99,.55);
    }

    .slideBody{
      margin-top:26px;
      font-size:20px;
      line-height:1.75;
      color:rgba(233,238,247,.92);
      position:relative;
      z-index:1;
      white-space:pre-wrap;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    .slideFooter{
      position:absolute;
      bottom:22px;
      left:26px;
      right:26px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      color:rgba(233,238,247,.62);
      font-weight:700;
      z-index:1;
    }

    /* Editor Panel */
    .panel{
      min-height:0;
      max-height:100%;
      padding:0;
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }
    .panelContent{
      flex:1;
      overflow-y:auto;
      overflow-x:hidden;
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .panelContent::-webkit-scrollbar{
      width:8px;
    }
    .panelContent::-webkit-scrollbar-track{
      background:rgba(255,255,255,.05);
      border-radius:10px;
    }
    .panelContent::-webkit-scrollbar-thumb{
      background:rgba(255,255,255,.15);
      border-radius:10px;
    }
    .panelContent::-webkit-scrollbar-thumb:hover{
      background:rgba(255,255,255,.25);
    }
    .panelFooter{
      padding:12px 14px;
      border-top:1px solid rgba(255,255,255,.1);
      background:rgba(0,0,0,.2);
    }
    .panel h2{
      margin:4px 2px 0;
      font-size:14px;
      color:rgba(233,238,247,.82);
      font-weight:900;
    }
    .panel h3{
      margin:8px 2px 4px;
      font-size:13px;
      color:rgba(0,191,99,.9);
      font-weight:800;
      border-bottom:1px solid rgba(255,255,255,.1);
      padding-bottom:6px;
    }
    .field{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    label{
      font-size:12px;
      color:rgba(233,238,247,.75);
      font-weight:800;
    }
    input, textarea, select{
      width:100%;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding:10px 10px;
      outline:none;
      font-family: inherit;
      font-weight:700;
      font-size:13px;
    }
    select{
      cursor:pointer;
    }
    input[type="color"]{
      padding:4px;
      height:38px;
      cursor:pointer;
    }
    input[type="range"]{
      padding:0;
      height:6px;
      cursor:pointer;
      -webkit-appearance:none;
      background: rgba(255,255,255,.15);
      border-radius:10px;
    }
    input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none;
      width:16px;height:16px;
      background:var(--accent);
      border-radius:50%;
      cursor:pointer;
    }
    textarea{
      min-height: 140px;
      resize: vertical;
      line-height:1.6;
      font-weight:600;
    }
    .row{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .row > *{flex:1; min-width:0;}
    .row3 > *{flex:1 1 30%;}

    .glowItem{
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.1);
      border-radius:12px;
      padding:10px;
      margin-bottom:8px;
    }
    .glowItem .row{margin-top:6px;}
    .glowHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .glowHeader span{
      font-size:12px;
      font-weight:800;
      color:var(--muted);
    }
    .btnSmall{
      padding:5px 10px;
      font-size:11px;
      border-radius:8px;
    }

    .collapsible{
      cursor:pointer;
      user-select:none;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .collapsible::before{
      content:"â–¼";
      font-size:10px;
      transition: transform .2s;
    }
    .collapsible.collapsed::before{
      transform: rotate(-90deg);
    }
    .collapsibleContent{
      transition: max-height .3s ease;
    }
    .collapsibleContent.collapsed{
      max-height:0 !important;
      padding:0;
      margin:0;
    }

    /* Bottom Strip */
    footer{
      padding:12px;
      display:flex;
      gap:10px;
      overflow:auto;
      align-items:center;
    }

    .thumb{
      width:160px;
      min-width:160px;
      aspect-ratio: 16/9;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      padding:10px;
      cursor:pointer;
      position:relative;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
    }
    .thumb:hover{background: rgba(255,255,255,.10)}
    .thumb:active{transform:scale(.98)}
    .thumb.active{
      border-color: rgba(0,191,99,.55);
      box-shadow: 0 0 0 2px rgba(0,191,99,.18) inset;
    }
    .thumbTitle{
      font-size:12px;
      font-weight:900;
      line-height:1.25;
      max-height: 30px;
      overflow:hidden;
      text-overflow: ellipsis;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
    }
    .thumbText{
      margin-top:6px;
      font-size:10px;
      color:rgba(233,238,247,.70);
      line-height:1.35;
      max-height: 44px;
      overflow:hidden;
      display:-webkit-box;
      -webkit-line-clamp:3;
      -webkit-box-orient:vertical;
      white-space:pre-wrap;
    }
    .thumbIndex{
      position:absolute;
      top:8px; left:8px;
      font-size:11px;
      color:rgba(233,238,247,.70);
      font-weight:900;
      padding:5px 9px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.25);
      backdrop-filter: blur(10px);
    }

    /* Responsive */
    @media (max-width: 1100px){
      main{grid-template-columns: 1fr}
      .panel{order: -1; max-height: 350px;}
    }
  </style>
</head>

<body>
  <div class="app">
    <header class="glass">
      <div class="brand">
        <span class="logoDot"></span>
        <div>
          <h1>Liquid Glass Slides</h1>
          <small>Ù…Ø­Ø±Ù‘Ø± Ø´Ø±Ø§Ø¦Ø­ Ù„Ù„Ù…Ù‚Ø§Ù„Ø§Øª â€” ØªØµØ¯ÙŠØ± PDF Ù„Ø±ÙØ¹Ù‡Ø§ ÙÙŠ LinkedIn</small>
        </div>
      </div>

      <div class="toolbar">
        <button class="btnGhost" id="btnNew">+ Ø´Ø±ÙŠØ­Ø©</button>
        <button class="btnGhost" id="btnDup">Ù†Ø³Ø®</button>
        <button class="btnDanger" id="btnDel">Ø­Ø°Ù</button>
        <button class="btnAccent" id="btnExport">ØªØµØ¯ÙŠØ± PDF</button>
      </div>
    </header>

    <main>
      <section class="stage glass">
        <div class="slideWrap" id="exportWrapper">
          <!-- PDF Page Background -->
          <div class="pdfPageBg" id="pdfPageBg"></div>
          <!-- IMPORTANT: this element is what we export -->
          <div class="slide" id="slideExportRoot" aria-label="Slide">
            <div class="slideHeader">
              <div>
                <h2 class="slideTitle" id="vTitle">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ø±ÙŠØ­Ø©</h2>
                <div class="chip">
                  <span class="chipDot"></span>
                  <span id="vChip">Ø³Ù„Ø³Ù„Ø© Â· Ø§Ù„Ø¬Ø²Ø¡ 01</span>
                </div>
              </div>
              <div class="slideMeta">
                <div id="vAuthor">Yazeed Alasmari</div>
                <div id="vPage">01 / 01</div>
              </div>
            </div>

            <div class="slideBody" id="vBody">Ø§ÙƒØªØ¨ Ù†ØµÙ‘Ùƒ Ù‡Ù†Ø§â€¦</div>

            <div class="slideFooter">
              <span id="vFooterLeft">linkedin.com</span>
              <span id="vFooterRight">Liquid Glass</span>
            </div>
          </div>
        </div>
      </section>

      <aside class="panel glass">
        <div class="panelContent">
        <!-- Content Section -->
        <h3 class="collapsible" data-target="contentSection">ğŸ“ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø´Ø±ÙŠØ­Ø©</h3>
        <div class="collapsibleContent" id="contentSection">
          <div class="field">
            <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
            <input id="iTitle" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø¯ÙˆØ§Øª ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©" />
          </div>

          <div class="row">
            <div class="field">
              <label>Ø§Ù„Ø´ÙŠØ¨ (Chip)</label>
              <input id="iChip" placeholder="Ø³Ù„Ø³Ù„Ø© Â· Ø§Ù„Ø¬Ø²Ø¡ 01" />
            </div>
            <div class="field">
              <label>Ø§Ù„ÙƒØ§ØªØ¨/Ø§Ù„Ù‡ÙˆÙŠØ©</label>
              <input id="iAuthor" placeholder="Yazeed Alasmari" />
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label>Ù†Øµ Ø§Ù„ÙÙˆØªØ± ÙŠØ³Ø§Ø±</label>
              <input id="iFooterLeft" placeholder="yazeed.site" />
            </div>
            <div class="field">
              <label>Ù†Øµ Ø§Ù„ÙÙˆØªØ± ÙŠÙ…ÙŠÙ†</label>
              <input id="iFooterRight" placeholder="Web Audit Toolkit" />
            </div>
          </div>

          <div class="field">
            <label>Ø§Ù„Ù†Øµ</label>
            <textarea id="iBody" placeholder="Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„Ø´Ø±ÙŠØ­Ø©â€¦ (ÙŠØ¯Ø¹Ù… Ø£Ø³Ø·Ø± Ù…ØªØ¹Ø¯Ø¯Ø©)"></textarea>
          </div>
        </div>

        <!-- Card Background Section -->
        <h3 class="collapsible" data-target="cardBgSection">ğŸ¨ Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© (Card)</h3>
        <div class="collapsibleContent" id="cardBgSection">
          <div class="field">
            <label>Ù†ÙˆØ¹ Ø§Ù„Ø®Ù„ÙÙŠØ©</label>
            <select id="cardBgType">
              <option value="gradient">ØªØ¯Ø±Ø¬ Ù„ÙˆÙ†ÙŠ (Gradient)</option>
              <option value="solid">Ù„ÙˆÙ† Ø«Ø§Ø¨Øª</option>
              <option value="image">ØµÙˆØ±Ø©</option>
            </select>
          </div>

          <div id="cardGradientOptions">
            <div class="field">
              <label>Ù„ÙˆÙ† Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</label>
              <div class="row">
                <input type="color" id="cardGradient1" value="#0a0f1a" />
                <input type="color" id="cardGradient2" value="#0d1520" />
              </div>
            </div>
          </div>

          <div id="cardSolidOptions" style="display:none">
            <div class="field">
              <label>Ø§Ù„Ù„ÙˆÙ†</label>
              <input type="color" id="cardSolidColor" value="#0a1015" />
            </div>
          </div>

          <div id="cardImageOptions" style="display:none">
            <div class="field">
              <label>Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©</label>
              <input id="cardImageUrl" placeholder="https://example.com/image.jpg" />
            </div>
          </div>

          <!-- Glows Section -->
          <h3 class="collapsible" data-target="glowsSection" style="margin-top:12px">âœ¨ Ø§Ù„ØªÙˆÙ‡Ø¬Ø§Øª (Glows)</h3>
          <div class="collapsibleContent" id="glowsSection">
            <div id="glowsList"></div>
            <button class="btnGhost btnSmall" id="btnAddGlow">+ Ø¥Ø¶Ø§ÙØ© ØªÙˆÙ‡Ø¬</button>
          </div>
        </div>

        <!-- PDF Page Background Section -->
        <h3 class="collapsible" data-target="pdfBgSection">ğŸ“„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØµÙØ­Ø© Ø§Ù„Ù€ PDF</h3>
        <div class="collapsibleContent" id="pdfBgSection">
          <div class="field">
            <label>Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„ØµÙØ­Ø©</label>
            <select id="pageFormat">
              <option value="16:9">Ø¹Ø±Ø¶ ØªÙ‚Ø¯ÙŠÙ…ÙŠ (16:9)</option>
              <option value="1:1">Ù…Ø±Ø¨Ø¹ - Instagram (1:1)</option>
              <option value="4:5">Ø¨ÙˆØ±ØªØ±ÙŠÙ‡ - Instagram (4:5)</option>
              <option value="9:16">Ø³ØªÙˆØ±ÙŠ - Instagram/TikTok (9:16)</option>
              <option value="4:3">ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ (4:3)</option>
              <option value="3:2">ØµÙˆØ±Ø© ÙÙˆØªÙˆØºØ±Ø§ÙÙŠØ© (3:2)</option>
              <option value="A4">A4 Ø¹Ù…ÙˆØ¯ÙŠ</option>
              <option value="A4-L">A4 Ø£ÙÙ‚ÙŠ</option>
            </select>
          </div>

          <div class="field">
            <label style="display:flex;align-items:center;gap:10px;cursor:pointer">
              <input type="checkbox" id="syncBgWithCard" style="width:auto;accent-color:var(--accent)" />
              Ù…Ø·Ø§Ø¨Ù‚Ø© Ø®Ù„ÙÙŠØ© Ø§Ù„ØµÙØ­Ø© Ù…Ø¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© (Liquid Glass)
            </label>
          </div>

          <div id="pdfCustomBgOptions">
            <div class="field">
              <label>Ù†ÙˆØ¹ Ø§Ù„Ø®Ù„ÙÙŠØ©</label>
              <select id="pdfBgType">
                <option value="gradient">ØªØ¯Ø±Ø¬ Ù„ÙˆÙ†ÙŠ (Gradient)</option>
                <option value="solid">Ù„ÙˆÙ† Ø«Ø§Ø¨Øª</option>
                <option value="image">ØµÙˆØ±Ø©</option>
              </select>
            </div>

            <div id="pdfGradientOptions">
              <div class="field">
                <label>Ø£Ù„ÙˆØ§Ù† Ø§Ù„ØªØ¯Ø±Ø¬</label>
                <div class="row">
                  <input type="color" id="pdfGradient1" value="#070a12" />
                  <input type="color" id="pdfGradient2" value="#0d1420" />
                </div>
              </div>
              <div class="field">
                <label>Ø²Ø§ÙˆÙŠØ© Ø§Ù„ØªØ¯Ø±Ø¬</label>
                <input type="range" id="pdfGradientAngle" min="0" max="360" value="135" />
              </div>
            </div>

            <div id="pdfSolidOptions" style="display:none">
              <div class="field">
                <label>Ø§Ù„Ù„ÙˆÙ†</label>
                <input type="color" id="pdfSolidColor" value="#0a0f15" />
              </div>
            </div>

            <div id="pdfImageOptions" style="display:none">
              <div class="field">
                <label>Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©</label>
                <input id="pdfImageUrl" placeholder="https://example.com/image.jpg" />
              </div>
            </div>
          </div>
        </div>
        </div>

        <!-- Navigation -->
        <div class="panelFooter">
          <div class="row">
            <button class="btnGhost" id="btnPrev">â¬…ï¸ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
            <button class="btnGhost" id="btnNext">Ø§Ù„ØªØ§Ù„ÙŠ âœ</button>
          </div>
        </div>
      </aside>
    </main>

    <footer class="glass" id="thumbStrip" aria-label="Thumbnails"></footer>
  </div>

<script>
  const $ = (id) => document.getElementById(id);

  // Default glow settings
  const defaultGlows = () => [
    { color: "#00bf63", x: 30, y: 20, width: 700, height: 400, opacity: 22, spread: 55 },
    { color: "#008cff", x: 85, y: 25, width: 700, height: 500, opacity: 18, spread: 55 },
    { color: "#ff6432", x: 60, y: 80, width: 600, height: 400, opacity: 12, spread: 50 },
  ];

  // Background settings
  let bgSettings = {
    card: {
      type: "gradient",
      gradient1: "#0a0f1a",
      gradient2: "#0d1520",
      solidColor: "#0a1015",
      imageUrl: ""
    },
    pdf: {
      type: "gradient",
      gradient1: "#070a12",
      gradient2: "#0d1420",
      gradientAngle: 135,
      solidColor: "#0a0f15",
      imageUrl: "",
      syncWithCard: false
    },
    pageFormat: "16:9",
    glows: defaultGlows()
  };

  const defaults = () => ({
    title: "Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ø±ÙŠØ­Ø©",
    chip: "Ø³Ù„Ø³Ù„Ø© Â· Ø§Ù„Ø¬Ø²Ø¡ 01",
    author: "Yazeed Alasmari",
    body: "Ø§ÙƒØªØ¨ Ù†ØµÙ‘Ùƒ Ù‡Ù†Ø§â€¦",
    footerLeft: "yazeed.site",
    footerRight: "Web Audit",
  });

  let slides = [defaults()];
  let active = 0;

  const vTitle = $("vTitle");
  const vChip = $("vChip");
  const vAuthor = $("vAuthor");
  const vBody = $("vBody");
  const vFooterLeft = $("vFooterLeft");
  const vFooterRight = $("vFooterRight");
  const vPage = $("vPage");

  const iTitle = $("iTitle");
  const iChip = $("iChip");
  const iAuthor = $("iAuthor");
  const iBody = $("iBody");
  const iFooterLeft = $("iFooterLeft");
  const iFooterRight = $("iFooterRight");

  function pad2(n){ return String(n).padStart(2,"0"); }

  // Hex to RGBA helper
  function hexToRgba(hex, alpha) {
    const r = parseInt(hex.slice(1,3), 16);
    const g = parseInt(hex.slice(3,5), 16);
    const b = parseInt(hex.slice(5,7), 16);
    return `rgba(${r},${g},${b},${alpha})`;
  }

  // Generate card background CSS
  function generateCardBackground() {
    const { card, glows } = bgSettings;
    let layers = [];

    // Add glows
    glows.forEach(g => {
      const rgba = hexToRgba(g.color, g.opacity / 100);
      layers.push(`radial-gradient(${g.width}px ${g.height}px at ${g.x}% ${g.y}%, ${rgba}, transparent ${g.spread}%)`);
    });

    // Add base background
    if (card.type === "gradient") {
      layers.push(`linear-gradient(135deg, ${card.gradient1} 0%, ${card.gradient2} 100%)`);
    } else if (card.type === "solid") {
      layers.push(`linear-gradient(0deg, ${card.solidColor}, ${card.solidColor})`);
    } else if (card.type === "image" && card.imageUrl) {
      layers.push(`url(${card.imageUrl})`);
    }

    return layers.join(", ");
  }

  // Generate PDF page background CSS
  function generatePdfBackground() {
    const { pdf, card, glows } = bgSettings;
    
    // If sync with card is enabled, use card background
    if (pdf.syncWithCard) {
      return generateCardBackground();
    }
    
    if (pdf.type === "gradient") {
      return `linear-gradient(${pdf.gradientAngle}deg, ${pdf.gradient1} 0%, ${pdf.gradient2} 100%)`;
    } else if (pdf.type === "solid") {
      return pdf.solidColor;
    } else if (pdf.type === "image" && pdf.imageUrl) {
      return `url(${pdf.imageUrl}) center/cover no-repeat`;
    }
    return "#0a0f15";
  }

  // Apply backgrounds
  function applyBackgrounds() {
    const slide = $("slideExportRoot");
    const pdfBg = $("pdfPageBg");

    slide.style.background = generateCardBackground();
    slide.style.backgroundSize = bgSettings.card.type === "image" ? "cover" : "auto";
    slide.style.backgroundPosition = "center";

    pdfBg.style.background = generatePdfBackground();
  }

  // Render glows list
  function renderGlowsList() {
    const container = $("glowsList");
    container.innerHTML = "";

    bgSettings.glows.forEach((g, idx) => {
      const item = document.createElement("div");
      item.className = "glowItem";
      item.innerHTML = `
        <div class="glowHeader">
          <span>ØªÙˆÙ‡Ø¬ ${idx + 1}</span>
          <button class="btnDanger btnSmall" onclick="removeGlow(${idx})">Ø­Ø°Ù</button>
        </div>
        <div class="row" style="margin-top:8px">
          <div class="field">
            <label>Ø§Ù„Ù„ÙˆÙ†</label>
            <input type="color" value="${g.color}" onchange="updateGlow(${idx}, 'color', this.value)" />
          </div>
          <div class="field">
            <label>Ø§Ù„Ù‚ÙˆØ© %</label>
            <input type="number" value="${g.opacity}" min="1" max="100" onchange="updateGlow(${idx}, 'opacity', +this.value)" />
          </div>
        </div>
        <div class="row">
          <div class="field">
            <label>Ø§Ù„Ù…ÙˆÙ‚Ø¹ X %</label>
            <input type="range" value="${g.x}" min="0" max="100" onchange="updateGlow(${idx}, 'x', +this.value)" />
          </div>
          <div class="field">
            <label>Ø§Ù„Ù…ÙˆÙ‚Ø¹ Y %</label>
            <input type="range" value="${g.y}" min="0" max="100" onchange="updateGlow(${idx}, 'y', +this.value)" />
          </div>
        </div>
        <div class="row">
          <div class="field">
            <label>Ø§Ù„Ø¹Ø±Ø¶</label>
            <input type="number" value="${g.width}" min="100" max="1500" onchange="updateGlow(${idx}, 'width', +this.value)" />
          </div>
          <div class="field">
            <label>Ø§Ù„Ø§Ø±ØªÙØ§Ø¹</label>
            <input type="number" value="${g.height}" min="100" max="1000" onchange="updateGlow(${idx}, 'height', +this.value)" />
          </div>
          <div class="field">
            <label>Ø§Ù„Ø§Ù†ØªØ´Ø§Ø± %</label>
            <input type="number" value="${g.spread}" min="10" max="100" onchange="updateGlow(${idx}, 'spread', +this.value)" />
          </div>
        </div>
      `;
      container.appendChild(item);
    });
  }

  window.updateGlow = function(idx, prop, value) {
    bgSettings.glows[idx][prop] = value;
    applyBackgrounds();
  };

  window.removeGlow = function(idx) {
    bgSettings.glows.splice(idx, 1);
    renderGlowsList();
    applyBackgrounds();
  };

  $("btnAddGlow").onclick = () => {
    bgSettings.glows.push({
      color: "#ffffff",
      x: 50, y: 50,
      width: 500, height: 400,
      opacity: 15, spread: 50
    });
    renderGlowsList();
    applyBackgrounds();
  };

  // Card background type change
  $("cardBgType").onchange = function() {
    bgSettings.card.type = this.value;
    $("cardGradientOptions").style.display = this.value === "gradient" ? "block" : "none";
    $("cardSolidOptions").style.display = this.value === "solid" ? "block" : "none";
    $("cardImageOptions").style.display = this.value === "image" ? "block" : "none";
    applyBackgrounds();
  };

  $("cardGradient1").oninput = function() { bgSettings.card.gradient1 = this.value; applyBackgrounds(); };
  $("cardGradient2").oninput = function() { bgSettings.card.gradient2 = this.value; applyBackgrounds(); };
  $("cardSolidColor").oninput = function() { bgSettings.card.solidColor = this.value; applyBackgrounds(); };
  $("cardImageUrl").oninput = function() { bgSettings.card.imageUrl = this.value; applyBackgrounds(); };

  // PDF background type change
  $("pdfBgType").onchange = function() {
    bgSettings.pdf.type = this.value;
    $("pdfGradientOptions").style.display = this.value === "gradient" ? "block" : "none";
    $("pdfSolidOptions").style.display = this.value === "solid" ? "block" : "none";
    $("pdfImageOptions").style.display = this.value === "image" ? "block" : "none";
    applyBackgrounds();
  };

  $("pdfGradient1").oninput = function() { bgSettings.pdf.gradient1 = this.value; applyBackgrounds(); };
  $("pdfGradient2").oninput = function() { bgSettings.pdf.gradient2 = this.value; applyBackgrounds(); };
  $("pdfGradientAngle").oninput = function() { bgSettings.pdf.gradientAngle = +this.value; applyBackgrounds(); };
  $("pdfSolidColor").oninput = function() { bgSettings.pdf.solidColor = this.value; applyBackgrounds(); };
  $("pdfImageUrl").oninput = function() { bgSettings.pdf.imageUrl = this.value; applyBackgrounds(); };

  // Collapsible sections
  document.querySelectorAll(".collapsible").forEach(el => {
    el.onclick = function() {
      const target = $(this.dataset.target);
      this.classList.toggle("collapsed");
      target.classList.toggle("collapsed");
    };
  });

  // Sync background with card checkbox
  $("syncBgWithCard").onchange = function() {
    bgSettings.pdf.syncWithCard = this.checked;
    $("pdfCustomBgOptions").style.display = this.checked ? "none" : "block";
    applyBackgrounds();
  };

  // Page format change
  $("pageFormat").onchange = function() {
    bgSettings.pageFormat = this.value;
    updateSlideWrapSize();
  };

  // Update slide wrap size based on format (only page size changes, card stays fixed)
  function updateSlideWrapSize() {
    const wrapper = $('exportWrapper');
    const slide = $('slideExportRoot');
    const format = bgSettings.pageFormat;
    
    // Card dimensions stay fixed
    const cardWidth = 720;
    const cardMinHeight = 400;
    
    // Page padding around the card
    const padding = 40;
    
    const formats = {
      '16:9': { ratio: 16/9 },
      '1:1': { ratio: 1 },
      '4:5': { ratio: 4/5 },
      '9:16': { ratio: 9/16 },
      '4:3': { ratio: 4/3 },
      '3:2': { ratio: 3/2 },
      'A4': { ratio: 210/297 },
      'A4-L': { ratio: 297/210 }
    };
    
    const { ratio } = formats[format] || formats['16:9'];
    
    // Calculate wrapper size based on aspect ratio
    // The wrapper (page) changes, but card stays at fixed width
    let wrapperWidth, wrapperHeight;
    
    if (ratio >= 1) {
      // Landscape or square - width is primary
      wrapperWidth = cardWidth + padding * 2;
      wrapperHeight = wrapperWidth / ratio;
    } else {
      // Portrait - calculate based on having card fit nicely
      wrapperWidth = cardWidth + padding * 2;
      wrapperHeight = wrapperWidth / ratio;
    }
    
    wrapper.style.width = wrapperWidth + 'px';
    wrapper.style.height = wrapperHeight + 'px';
    wrapper.style.maxWidth = '100%';
  }

  function renderActive(){
    const s = slides[active];

    // View
    vTitle.textContent = s.title || "";
    vChip.textContent = s.chip || "";
    vAuthor.textContent = s.author || "";
    vBody.textContent = s.body || "";
    vFooterLeft.textContent = s.footerLeft || "";
    vFooterRight.textContent = s.footerRight || "";
    vPage.textContent = `${pad2(active+1)} / ${pad2(slides.length)}`;

    // Inputs
    iTitle.value = s.title || "";
    iChip.value = s.chip || "";
    iAuthor.value = s.author || "";
    iBody.value = s.body || "";
    iFooterLeft.value = s.footerLeft || "";
    iFooterRight.value = s.footerRight || "";

    renderThumbs();
  }

  function renderThumbs(){
    const strip = $("thumbStrip");
    strip.innerHTML = "";
    slides.forEach((s, idx) => {
      const t = document.createElement("div");
      t.className = "thumb" + (idx === active ? " active" : "");
      t.onclick = () => { active = idx; renderActive(); };

      const index = document.createElement("div");
      index.className = "thumbIndex";
      index.textContent = pad2(idx+1);

      const title = document.createElement("div");
      title.className = "thumbTitle";
      title.textContent = s.title || "";

      const body = document.createElement("div");
      body.className = "thumbText";
      body.textContent = s.body || "";

      t.appendChild(index);
      t.appendChild(title);
      t.appendChild(body);
      strip.appendChild(t);
    });
  }

  function bindInput(el, key){
    el.addEventListener("input", () => {
      slides[active][key] = el.value;
      renderActive();
    });
  }

  bindInput(iTitle, "title");
  bindInput(iChip, "chip");
  bindInput(iAuthor, "author");
  bindInput(iBody, "body");
  bindInput(iFooterLeft, "footerLeft");
  bindInput(iFooterRight, "footerRight");

  $("btnNew").onclick = () => {
    slides.push(defaults());
    active = slides.length - 1;
    slides[active].chip = `Ø³Ù„Ø³Ù„Ø© Â· Ø§Ù„Ø¬Ø²Ø¡ ${pad2(active+1)}`;
    renderActive();
  };

  $("btnDup").onclick = () => {
    const copy = JSON.parse(JSON.stringify(slides[active]));
    slides.splice(active+1, 0, copy);
    active = active + 1;
    renderActive();
  };

  $("btnDel").onclick = () => {
    if(slides.length === 1){
      slides = [defaults()];
      active = 0;
      renderActive();
      return;
    }
    slides.splice(active, 1);
    active = Math.max(0, active - 1);
    renderActive();
  };

  $("btnPrev").onclick = () => {
    active = Math.max(0, active - 1);
    renderActive();
  };
  $("btnNext").onclick = () => {
    active = Math.min(slides.length - 1, active + 1);
    renderActive();
  };

  async function exportPDF(){
    const { jsPDF } = window.jspdf;

    // Get page dimensions based on format
    const formats = {
      "16:9": { w: 1920, h: 1080 },
      "1:1": { w: 1080, h: 1080 },
      "4:5": { w: 1080, h: 1350 },
      "9:16": { w: 1080, h: 1920 },
      "4:3": { w: 1440, h: 1080 },
      "3:2": { w: 1620, h: 1080 },
      "A4": { w: 595, h: 842 },
      "A4-L": { w: 842, h: 595 }
    };
    
    const { w, h } = formats[bgSettings.pageFormat] || formats["16:9"];
    const orientation = w > h ? "landscape" : "portrait";

    const pdf = new jsPDF({ orientation, unit: "pt", format: [w, h] });
    const pageW = pdf.internal.pageSize.getWidth();
    const pageH = pdf.internal.pageSize.getHeight();

    const wrapper = $("exportWrapper");
    const originalActive = active;
    const scale = 2;

    for(let i=0; i<slides.length; i++){
      active = i;
      const s = slides[active];
      vTitle.textContent = s.title || "";
      vChip.textContent = s.chip || "";
      vAuthor.textContent = s.author || "";
      vBody.textContent = s.body || "";
      vFooterLeft.textContent = s.footerLeft || "";
      vFooterRight.textContent = s.footerRight || "";
      vPage.textContent = `${pad2(active+1)} / ${pad2(slides.length)}`;

      // Capture the whole wrapper (includes PDF background + card with glass effect)
      const canvas = await html2canvas(wrapper, {
        backgroundColor: null,
        scale,
        useCORS: true
      });

      const imgData = canvas.toDataURL("image/png");

      // Fill page with PDF background color first
      const pdfBgColor = bgSettings.pdf.type === "solid" ? bgSettings.pdf.solidColor : bgSettings.pdf.gradient1;
      pdf.setFillColor(pdfBgColor);
      pdf.rect(0, 0, pageW, pageH, 'F');

      // Fit image into page
      const margin = 40;
      const maxW = pageW - margin*2;
      const maxH = pageH - margin*2;

      const imgW = canvas.width;
      const imgH = canvas.height;
      const ratio = Math.min(maxW / imgW, maxH / imgH);
      const drawW = imgW * ratio;
      const drawH = imgH * ratio;

      const x = (pageW - drawW) / 2;
      const y = (pageH - drawH) / 2;

      if(i > 0) pdf.addPage();
      
      // Draw background
      pdf.setFillColor(pdfBgColor);
      pdf.rect(0, 0, pageW, pageH, 'F');
      
      pdf.addImage(imgData, "PNG", x, y, drawW, drawH);
    }

    active = originalActive;
    renderActive();

    pdf.save("Liquid-Glass-Article.pdf");
  }

  $("btnExport").onclick = exportPDF;

  // Initialize
  slides[0].chip = "Ø³Ù„Ø³Ù„Ø© Â· Ø§Ù„Ø¬Ø²Ø¡ 01";
  slides[0].footerLeft = "yazeed.site";
  slides[0].footerRight = "Web Audit Toolkit";
  renderActive();
  renderGlowsList();
  applyBackgrounds();
  updateSlideWrapSize();
</script>
</body>
</html>
